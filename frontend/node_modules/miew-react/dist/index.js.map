{"version":3,"file":"index.js","sources":["../src/state/common/initSlice.ts","../src/state/common/initSaga.ts","../src/state/rootSaga.ts","../src/state/store.ts","../src/theming/defaultTheme.ts","../src/Viewer.tsx"],"sourcesContent":["import { createSlice, PayloadAction } from '@reduxjs/toolkit'\r\n\r\nexport interface EditorState {\r\n  isInitialized: boolean\r\n  data: string | undefined\r\n  error: string | undefined\r\n}\r\n\r\nconst initialState: EditorState = {\r\n  isInitialized: false,\r\n  data: undefined,\r\n  error: undefined\r\n}\r\n\r\nexport const InitSlice = createSlice({\r\n  name: 'init',\r\n  initialState,\r\n  reducers: {\r\n    INIT: (state: EditorState) => {\r\n      state.isInitialized = false\r\n      state.data = undefined\r\n      state.error = undefined\r\n    },\r\n    INIT_SUCCESS: (state: EditorState, action: PayloadAction<string>) => {\r\n      state.isInitialized = true\r\n      state.data = action.payload\r\n      state.error = undefined\r\n    },\r\n    INIT_FAIL: (state: EditorState, action: PayloadAction<string>) => {\r\n      state.isInitialized = false\r\n      state.data = undefined\r\n      state.error = action.payload\r\n    }\r\n  }\r\n})\r\n\r\nexport const { INIT, INIT_SUCCESS, INIT_FAIL } = InitSlice.actions\r\n\r\nexport const initReducer = InitSlice.reducer\r\n","import { put, call, takeEvery } from 'redux-saga/effects'\r\nimport { INIT, INIT_SUCCESS, INIT_FAIL } from './initSlice'\r\n\r\nconst fetchInitData = (url: string) =>\r\n  new Promise((resolve) =>\r\n    setTimeout(() => resolve(`data fetched from ${url}`), 2000)\r\n  )\r\nconst TEST_URL = 'some/url'\r\n\r\nfunction* initApp() {\r\n  try {\r\n    const data = yield call(fetchInitData, TEST_URL)\r\n    yield put(INIT_SUCCESS(data))\r\n  } catch (error) {\r\n    yield put(INIT_FAIL('SAMPLE ERROR'))\r\n  }\r\n}\r\n\r\nexport function* watchInitApp() {\r\n  yield takeEvery(INIT, initApp)\r\n}\r\n","import { spawn } from 'redux-saga/effects'\r\nimport { watchInitApp } from 'state/common'\r\n\r\nexport function* rootSaga() {\r\n  yield spawn(watchInitApp)\r\n}\r\n","import createSagaMiddleware from 'redux-saga'\r\nimport { configureStore } from '@reduxjs/toolkit'\r\nimport { rootSaga } from 'state/rootSaga'\r\nimport { initReducer } from 'state/common'\r\n\r\nconst sagaMiddleware = createSagaMiddleware()\r\n\r\nexport const store = configureStore({\r\n  reducer: {\r\n    init: initReducer\r\n  },\r\n  middleware: (getDefaultMiddleware) =>\r\n    getDefaultMiddleware().concat(sagaMiddleware)\r\n})\r\n\r\nsagaMiddleware.run(rootSaga)\r\n\r\nexport type RootState = ReturnType<typeof store.getState>\r\nexport type AppDispatch = typeof store.dispatch\r\n","import { MiewTheme } from './theme.types'\r\n\r\nexport const defaultTheme: MiewTheme = {\r\n  palette: {\r\n    accent: {\r\n      main: '#2E6DA4',\r\n      dark: '#204D74',\r\n      light: '#337AB7'\r\n    },\r\n    primary: {\r\n      main: '#DDD',\r\n      light: '#FFF',\r\n      dark: '#DDD'\r\n    },\r\n    secondary: {\r\n      main: '#333',\r\n      light: '#C0C0C0',\r\n      dark: '#383838'\r\n    }\r\n  },\r\n  typography: {\r\n    fontSize: 16,\r\n    fontFamily: 'sans-serif'\r\n  }\r\n}\r\n","import { useLayoutEffect, useRef } from 'react'\r\nimport { Provider } from 'react-redux'\r\nimport { Miew, MiewOptions } from 'miew'\r\nimport useResizeObserver from 'use-resize-observer'\r\nimport { Theme, ThemeProvider } from '@emotion/react'\r\nimport { createTheme } from '@mui/material/styles'\r\nimport { CssBaseline } from '@mui/material'\r\nimport { merge } from 'lodash'\r\nimport { store } from 'state'\r\nimport { defaultTheme, MiewTheme } from './theming'\r\n\r\nconst MEDIA_SIZES = {\r\n  smallWidth: 800,\r\n  smallHeight: 400\r\n}\r\n\r\ntype DeepPartial<T> = {\r\n  [P in keyof T]?: DeepPartial<T[P]>\r\n}\r\n\r\ntype ViewerProps = {\r\n  onInit?: (miew: Miew) => void\r\n  options?: MiewOptions\r\n  theme?: DeepPartial<MiewTheme>\r\n}\r\n\r\nconst muiTheme = createTheme()\r\n\r\nconst Viewer = ({ onInit, options, theme }: ViewerProps) => {\r\n  const viewerTheme = theme ? merge(defaultTheme, theme) : defaultTheme\r\n\r\n  const ref = useRef<HTMLDivElement>(null)\r\n  const { width, height } = useResizeObserver<HTMLDivElement>({ ref })\r\n\r\n  const isSizeSmall =\r\n    (height && height <= MEDIA_SIZES.smallHeight) ||\r\n    (width && width <= MEDIA_SIZES.smallWidth)\r\n\r\n  const viewerStyle = (theme: Theme) => {\r\n    const palette = theme.miew.palette\r\n    return {\r\n      backgroundColor: isSizeSmall ? palette.accent.main : palette.primary.main,\r\n      height: '100%',\r\n      width: '100%',\r\n      '& > .miew-canvas': {\r\n        height: '100%',\r\n        width: '100%'\r\n      }\r\n    }\r\n  }\r\n\r\n  useLayoutEffect(() => {\r\n    const miew = new Miew({\r\n      container: ref?.current,\r\n      ...options\r\n    })\r\n    if (miew.init()) miew.run()\r\n    if (typeof onInit === 'function') onInit(miew)\r\n  }, [options, onInit])\r\n\r\n  return (\r\n    <Provider store={store}>\r\n      <ThemeProvider theme={merge(muiTheme, { miew: viewerTheme })}>\r\n        <CssBaseline />\r\n        <div ref={ref} css={viewerStyle} />\r\n      </ThemeProvider>\r\n    </Provider>\r\n  )\r\n}\r\n\r\nexport { Viewer }\r\n"],"names":["initialState","isInitialized","data","undefined","error","InitSlice","createSlice","name","reducers","INIT","state","INIT_SUCCESS","action","payload","INIT_FAIL","actions","initReducer","reducer","initApp","watchInitApp","fetchInitData","url","Promise","resolve","setTimeout","TEST_URL","call","put","takeEvery","rootSaga","spawn","sagaMiddleware","createSagaMiddleware","store","configureStore","init","middleware","getDefaultMiddleware","concat","run","defaultTheme","palette","accent","main","dark","light","primary","secondary","typography","fontSize","fontFamily","MEDIA_SIZES","smallWidth","smallHeight","muiTheme","createTheme","Viewer","onInit","options","theme","viewerTheme","merge","ref","useRef","useResizeObserver","width","height","isSizeSmall","viewerStyle","miew","backgroundColor","useLayoutEffect","Miew","container","current","_jsx","Provider","_jsxs","ThemeProvider","CssBaseline","css"],"mappings":"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"}